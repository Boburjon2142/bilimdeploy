{% extends "base.html" %}
{% block content %}
<div class="px-3 py-3">
  <h4 class="fw-bold mb-3">Ro‘yxatdan o‘tish</h4>
  <form method="post" class="card border-0 shadow-sm p-3" style="border-radius:16px;">
    {% csrf_token %}
    {% if form.non_field_errors %}
    <div class="alert alert-danger py-2">
      {% for err in form.non_field_errors %}<div>{{ err }}</div>{% endfor %}
    </div>
    {% endif %}
    <div class="mb-3">
      <label class="form-label">Ism F.I.O.</label>
      {{ form.full_name }}
      {% if form.full_name.errors %}<div class="text-danger small">{{ form.full_name.errors|striptags }}</div>{% endif %}
    </div>
    <div class="mb-3">
      <label class="form-label">Telefon</label>
      {{ form.phone }}
      {% if form.phone.errors %}<div class="text-danger small">{{ form.phone.errors|striptags }}</div>{% endif %}
    </div>
    <div class="mb-3">
      <label class="form-label">Parol</label>
      {{ form.password1 }}
      {% if form.password1.errors %}<div class="text-danger small">{{ form.password1.errors|striptags }}</div>{% endif %}
    </div>
    <div class="mb-3">
      <label class="form-label">Parolni tasdiqlang</label>
      {{ form.password2 }}
      {% if form.password2.errors %}<div class="text-danger small">{{ form.password2.errors|striptags }}</div>{% endif %}
    </div>
    <button class="btn btn-primary w-100" type="submit">Ro‘yxatdan o‘tish</button>
    <div class="text-center mt-3">
      <a class="text-decoration-none" href="{% url 'login' %}">Kirish</a>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
  (function () {
    const input = document.getElementById("id_phone");
    if (!input) return;
    input.setAttribute("inputmode", "tel");
    input.setAttribute("autocomplete", "tel");
    const formatPhone = function (raw) {
      const digits = String(raw || "").replace(/\D/g, "");
      if (!digits) return "";
      let country = "";
      let rest = "";
      if (digits.startsWith("998")) {
        country = "998";
        rest = digits.slice(3);
      } else if (digits.length <= 9) {
        country = "998";
        rest = digits;
      } else {
        country = digits.slice(0, 3);
        rest = digits.slice(3);
      }
      const parts = [];
      if (rest.length > 0) parts.push(rest.slice(0, 2));
      if (rest.length > 2) parts.push(rest.slice(2, 5));
      if (rest.length > 5) parts.push(rest.slice(5, 7));
      if (rest.length > 7) parts.push(rest.slice(7, 9));
      if (rest.length > 9) parts.push(rest.slice(9));
      return "+" + country + (parts.length ? " " + parts.join(" ") : "");
    };
    const applyFormat = function () {
      input.value = formatPhone(input.value);
    };
    input.addEventListener("input", applyFormat);
    applyFormat();
  })();
</script>
{% endblock %}
